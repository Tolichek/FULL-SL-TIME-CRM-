<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLM CRM 2.0 - Tree Notebook</title>
    <style>
        :root {
            --primary-bg: #f4f7f6;
            --sidebar-bg: #2c3e50;
            --text-light: #ecf0f1;
            --accent: #3498db;
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background: var(--primary-bg);
        }

        /* Sidebar - Tree List */
        #sidebar {
            width: 300px;
            background: var(--sidebar-bg);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-header {
            padding: 20px;
            background: #1a252f;
            text-align: center;
        }

        #client-list {
            flex-grow: 1;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .client-item {
            padding: 15px 20px;
            border-bottom: 1px solid #34495e;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .client-item:hover {
            background: #3e5871;
        }

        .client-item.active {
            background: var(--accent);
        }

        .level-badge {
            background: #e67e22;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        /* Main Content - Form */
        #main-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .form-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .photo-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        #photo-preview {
            width: 120px;
            height: 120px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #fafafa;
        }

        #photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .grid-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #555;
        }

        input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .dynamic-list {
            margin-top: 10px;
        }

        .dynamic-item {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.3s;
        }

        .btn-add { background: #2ecc71; color: white; font-size: 0.8em; }
        .btn-save { background: var(--accent); color: white; width: 100%; margin-top: 20px; }
        .btn-new { background: #e74c3c; color: white; margin: 10px 20px; }

        .age-display {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-top: 4px;
        }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">Мій Списк (МЛМ)</div>
    <button class="btn btn-new" onclick="resetForm()">+ Нова анкета</button>
    <ul id="client-list">
        </ul>
</div>

<div id="main-content">
    <div class="form-card">
        <div class="photo-section">
            <div id="photo-preview"><span>Фото</span></div>
            <div>
                <input type="file" id="photo-input" accept="image/*" onchange="previewImage(this)">
                <p style="font-size: 0.8em; color: #888;">Завантажте фото клієнта</p>
            </div>
        </div>

        <div class="grid-fields">
            <div class="form-group">
                <label>Прізвище</label>
                <input type="text" id="lastName" placeholder="Введіть прізвище">
            </div>
            <div class="form-group">
                <label>Ім'я</label>
                <input type="text" id="firstName">
            </div>
            <div class="form-group">
                <label>По-батькові</label>
                <input type="text" id="middleName">
            </div>
            <div class="form-group">
                <label>Дата народження</label>
                <input type="date" id="birthDate" oninput="calculateAge()">
                <div id="age-text" class="age-display">Вік: -</div>
            </div>
        </div>

        <hr>

        <div class="grid-fields">
            <div class="form-group">
                <label>Номер консультанта</label>
                <input type="text" id="consultantId">
            </div>
            <div class="form-group">
                <label>Номер директорії</label>
                <input type="text" id="directoryId">
            </div>
            <div class="form-group">
                <label>Рівень</label>
                <input type="number" id="level" value="1">
            </div>
        </div>

        <div class="form-group">
            <label>Телефони</label>
            <div id="phone-container" class="dynamic-list">
                <div class="dynamic-item"><input type="tel" class="phone-input" placeholder="+380..."></div>
            </div>
            <button class="btn btn-add" onclick="addField('phone-container', 'tel')">+ Додати номер</button>
        </div>

        <div class="form-group">
            <label>Поліси (Дата випуску та Номер)</label>
            <div id="policy-container" class="dynamic-list">
                <div class="dynamic-item">
                    <input type="date" class="policy-date">
                    <input type="text" class="policy-num" placeholder="№ Полісу">
                </div>
            </div>
            <button class="btn btn-add" onclick="addField('policy-container', 'policy')">+ Додати поліс</button>
        </div>

        <button class="btn btn-save" onclick="saveClient()">Зберегти анкету</button>
    </div>
</div>

<script>
    let clients = JSON.parse(localStorage.getItem('mlm_clients')) || [];
    let currentEditId = null;

    function calculateAge() {
        const birthDate = document.getElementById('birthDate').value;
        if (!birthDate) return;
        const diff = Date.now() - new Date(birthDate).getTime();
        const age = new Date(diff).getUTCFullYear() - 1970;
        document.getElementById('age-text').innerText = `Вік: ${age} р.`;
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('photo-preview').innerHTML = `<img src="${e.target.result}">`;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addField(containerId, type) {
        const container = document.getElementById(containerId);
        const div = document.createElement('div');
        div.className = 'dynamic-item';
        
        if (type === 'tel') {
            div.innerHTML = `<input type="tel" class="phone-input" placeholder="+380...">`;
        } else {
            div.innerHTML = `<input type="date" class="policy-date"><input type="text" class="policy-num" placeholder="№ Полісу">`;
        }
        container.appendChild(div);
    }

    function saveClient() {
        const clientData = {
            id: currentEditId || Date.now(),
            photo: document.querySelector('#photo-preview img')?.src || '',
            lastName: document.getElementById('lastName').value,
            firstName: document.getElementById('firstName').value,
            middleName: document.getElementById('middleName').value,
            birthDate: document.getElementById('birthDate').value,
            consultantId: document.getElementById('consultantId').value,
            directoryId: document.getElementById('directoryId').value,
            level: document.getElementById('level').value,
            phones: Array.from(document.querySelectorAll('.phone-input')).map(i => i.value),
            policies: Array.from(document.querySelectorAll('#policy-container .dynamic-item')).map(item => ({
                date: item.querySelector('.policy-date').value,
                num: item.querySelector('.policy-num').value
            }))
        };

        if (currentEditId) {
            clients = clients.map(c => c.id === currentEditId ? clientData : c);
        } else {
            clients.push(clientData);
        }

        localStorage.setItem('mlm_clients', JSON.stringify(clients));
        renderList();
        resetForm();
    }

    function renderList() {
        const list = document.getElementById('client-list');
        list.innerHTML = '';
        clients.forEach(c => {
            const li = document.createElement('li');
            li.className = 'client-item';
            li.onclick = () => loadClient(c.id);
            li.innerHTML = `
                <span>${c.lastName} ${c.firstName}</span>
                <span class="level-badge">Lvl ${c.level}</span>
            `;
            list.appendChild(li);
        });
    }

    function loadClient(id) {
        const c = clients.find(cl => cl.id === id);
        currentEditId = id;
        
        document.getElementById('photo-preview').innerHTML = c.photo ? `<img src="${c.photo}">` : '<span>Фото</span>';
        document.getElementById('lastName').value = c.lastName;
        document.getElementById('firstName').value = c.firstName;
        document.getElementById('middleName').value = c.middleName;
        document.getElementById('birthDate').value = c.birthDate;
        document.getElementById('consultantId').value = c.consultantId;
        document.getElementById('directoryId').value = c.directoryId;
        document.getElementById('level').value = c.level;
        
        // Load Phones
        const pContainer = document.getElementById('phone-container');
        pContainer.innerHTML = '';
        c.phones.forEach(p => {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<input type="tel" class="phone-input" value="${p}">`;
            pContainer.appendChild(div);
        });

        // Load Policies
        const polContainer = document.getElementById('policy-container');
        polContainer.innerHTML = '';
        c.policies.forEach(pol => {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<input type="date" class="policy-date" value="${pol.date}"><input type="text" class="policy-num" value="${pol.num}">`;
            polContainer.appendChild(div);
        });
        
        calculateAge();
    }

    function resetForm() {
        currentEditId = null;
        document.getElementById('photo-preview').innerHTML = '<span>Фото</span>';
        document.querySelectorAll('input').forEach(i => i.value = '');
        document.getElementById('level').value = '1';
        document.getElementById('phone-container').innerHTML = '<div class="dynamic-item"><input type="tel" class="phone-input" placeholder="+380..."></div>';
        document.getElementById('policy-container').innerHTML = '<div class="dynamic-item"><input type="date" class="policy-date"><input type="text" class="policy-num" placeholder="№ Полісу"></div>';
        document.getElementById('age-text').innerText = 'Вік: -';
    }

    renderList();
</script>

</body>
</html>
