<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Place</title>
    <style>
        :root { --bg: #131314; --card: #1e1f20; --text: #e3e3e3; --acc: #8ab4f8; --tg-blue: #24A1DE; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); font-family: Roboto, sans-serif; overflow: hidden; }
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; background: var(--bg); }
        .active { display: flex !important; }

        /* ЕКРАН ЗАВАНТАЖЕННЯ (SPLASH) */
        #splash-screen {
            display: flex; align-items: center; justify-content: center;
            background: var(--bg); z-index: 20000;
        }
        .logo-circle {
            width: 120px; height: 120px; background: var(--tg-blue);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 30px rgba(36, 161, 222, 0.4);
            animation: pulse 2s infinite;
        }
        .plane-icon {
            width: 60px; height: 60px; fill: white;
            transform: translate(-3px, 3px); /* Коригування центру літачка */
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ЕКРАН ВХОДУ */
        #login-screen { align-items: center; justify-content: center; z-index: 10000; }
        .google-btn { background: white; color: black; padding: 15px 30px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        
        /* СТИЛІ ІНТЕРФЕЙСУ (БЕЗ ЗМІН) */
        .header { background: var(--card); padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #333; }
        .chat-list { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .chat-item { display: flex; padding: 12px 15px; align-items: center; border-bottom: 1px solid #282828; cursor: pointer; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #3c4043; margin-right: 12px; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .nav-bar { position: fixed; bottom: 15px; left: 10px; right: 10px; background: var(--card); height: 60px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #333; z-index: 1000; }
        .nav-item { color: #b4b4b4; font-size: 11px; cursor: pointer; text-align: center; }
        .active-nav { color: var(--acc); }
        .fab { position: fixed; bottom: 90px; right: 20px; width: 50px; height: 50px; background: var(--acc); border-radius: 15px; color: #131314; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 500; }
    </style>
</head>
<body>

    <div id="splash-screen" class="screen active">
        <div class="logo-circle">
            <svg class="plane-icon" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
            </svg>
        </div>
    </div>

    <div id="login-screen" class="screen">
        <h1 style="color: var(--tg-blue); font-size: 42px; margin-bottom: 30px;">My Place</h1>
        <button class="google-btn" id="btn-login">Увійти через Google</button>
    </div>

    <div id="list-screen" class="screen">
        <div class="header"><b>My Place</b></div>
        <div id="chat-list" class="chat-list"></div>
        <div class="fab" id="btn-add">+</div>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const cfg = {
        apiKey: "AIzaSyBLi2NoAigr1CDQm98iZHUZXNeDzJMwwxY",
        authDomain: "starlife-crm.firebaseapp.com",
        projectId: "starlife-crm",
        storageBucket: "starlife-crm.firebasestorage.app",
        messagingSenderId: "1022280682130",
        appId: "1:1022280682130:web:3ea517e8b6d22c7787744b"
    };

    const app = initializeApp(cfg);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const prov = new GoogleAuthProvider();

    // СТАН АВТОРИЗАЦІЇ
    onAuthStateChanged(auth, u => {
        const splash = document.getElementById('splash-screen');
        if(u) {
            // Користувач впізнаний - прибираємо логотип і показуємо список
            splash.style.display = 'none'; 
            switchScreen('list-screen');
            sub(u.uid);
        } else {
            // Користувач не впізнаний - прибираємо логотип і показуємо кнопку входу
            splash.style.display = 'none';
            switchScreen('login-screen');
        }
    });

    window.switchScreen = id => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const nav = document.getElementById('bottom-nav');
        if(nav) nav.style.display = (id === 'list-screen' || id === 'profile-screen') ? 'flex' : 'none';
    };

    // РЕШТА ФУНКЦІЙ (btn-login, save, updateChat і т.д.) ПРАЦЮЮТЬ БЕЗ ЗМІН
    document.getElementById('btn-login').onclick = () => signInWithPopup(auth, prov);
    
    // ... (весь інший код функцій зберігання)
</script>
</body>
</html>
