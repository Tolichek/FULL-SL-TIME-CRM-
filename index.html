<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Place CRM</title>
    <style>
        :root { --bg: #131314; --card: #1e1f20; --text: #e3e3e3; --acc: #8ab4f8; --brand-blue: #24A1DE; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); font-family: Roboto, sans-serif; overflow: hidden; }
        
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; background: var(--bg); }
        .active { display: flex !important; }

        /* –û–ù–û–í–õ–ï–ù–ê –ó–ê–°–¢–ê–í–ö–ê: –†–ï–ê–õ–Ü–°–¢–ò–ß–ù–ò–ô –°–£–í–Ü–ô –¢–ê –ü–ï–†–û */
        #splash-screen { display: flex; align-items: center; justify-content: center; background: var(--bg); z-index: 20000; }
        .splash-container { text-align: center; position: relative; width: 220px; height: 280px; }
        
        /* –¢—ñ–ª–æ —Å—É–≤–æ—é –∑ –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º –ø—ñ–¥ —Å—Ç–∞—Ä–∏–π –ø–∞–ø—ñ—Ä */
        .scroll-paper {
            width: 130px; height: 170px; 
            background: linear-gradient(135deg, #f4e4bc 0%, #e2cfa1 100%); 
            border-radius: 2px;
            position: absolute; left: 35px; top: 40px;
            box-shadow: 10px 10px 25px rgba(0,0,0,0.7);
            border-left: 2px solid #d4b483;
        }
        
        /* –û–±'—î–º–Ω—ñ –≤–∞–ª–∏–∫–∏ —Å—É–≤–æ—é */
        .scroll-roll {
            width: 145px; height: 30px; 
            background: linear-gradient(to bottom, #d4b483, #e2cfa1, #bc9a6a);
            position: absolute; left: 28px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            border: 1px solid #a68b5b;
        }
        .top-roll { top: 20px; }
        .bottom-roll { top: 200px; }

        /* –ï—Ñ–µ–∫—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —á–æ—Ä–Ω–∏–ª–æ–º */
        .ink-text {
            position: absolute; top: 70px; left: 50px; width: 100px; height: 130px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .ink-line {
            height: 2px; background: rgba(30, 20, 10, 0.8); width: 0; border-radius: 2px;
            box-shadow: 0 0 1px rgba(0,0,0,0.5);
            animation: ink-draw 3s infinite linear;
        }
        .line-2 { animation-delay: 0.7s; }
        .line-3 { animation-delay: 1.4s; }

        /* –ó–æ–ª–æ—Ç–µ –ø–µ—Ä–æ –∑ –¥–µ—Ç–∞–ª—è–º–∏ */
        .quill-gold {
            width: 80px; height: 120px; position: absolute;
            right: 0px; top: -15px; z-index: 10;
            filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.5));
            animation: writing-quill 3s infinite ease-in-out;
            transform-origin: bottom left;
        }

        @keyframes writing-quill {
            0% { transform: translate(0, 0) rotate(35deg); }
            25% { transform: translate(-40px, 40px) rotate(25deg); }
            50% { transform: translate(-70px, 80px) rotate(40deg); }
            75% { transform: translate(-30px, 120px) rotate(25deg); }
            100% { transform: translate(0, 0) rotate(35deg); }
        }

        @keyframes ink-draw {
            0%, 25% { width: 0; opacity: 0; }
            85%, 100% { width: 100%; opacity: 1; }
        }

        .splash-text { position: absolute; bottom: -10px; width: 100%; font-size: 22px; letter-spacing: 6px; text-transform: uppercase; color: #f4e4bc; font-weight: 300; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü CRM (–ë–ï–ó –ó–ú–Ü–ù) */
        #login-screen { align-items: center; justify-content: center; z-index: 10000; }
        .google-btn { background: white; color: black; padding: 15px 30px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .header { background: var(--card); padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #333; }
        .chat-list { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .chat-item { display: flex; padding: 12px 15px; align-items: center; border-bottom: 1px solid #282828; cursor: pointer; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #3c4043; margin-right: 12px; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .notes-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #0b0b0b; }
        .note-bubble { background: #2b2c2f; padding: 10px; border-radius: 15px; max-width: 85%; align-self: flex-start; }
        .nav-bar { position: fixed; bottom: 15px; left: 10px; right: 10px; background: var(--card); height: 60px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #333; z-index: 1000; }
        .nav-item { color: #b4b4b4; font-size: 11px; cursor: pointer; text-align: center; }
        .active-nav { color: var(--acc); }
        .fab { position: fixed; bottom: 90px; right: 20px; width: 50px; height: 50px; background: var(--acc); border-radius: 15px; color: #131314; display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; z-index: 500; }
        
        /* –ö–ê–†–¢–ö–ê –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø (–ï–¢–ê–õ–û–ù) */
        .profile-top { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .edit-inputs { width: 100%; display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
        .edit-inputs label { color: var(--acc); font-size: 11px; font-weight: bold; }
        .edit-inputs input { background: transparent; border: none; border-bottom: 1px solid #333; color: white; padding: 8px 0; outline: none; font-size: 17px; width: 100%; }
        .card-box { background: var(--card); margin: 10px; padding: 15px; border-radius: 12px; }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #282828; }
        .switch { position: relative; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; inset: 0; background: #444; border-radius: 20px; cursor: pointer; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background: var(--acc); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>

    <div id="splash-screen" class="screen active">
        <div class="splash-container">
            <div class="scroll-roll top-roll"></div>
            <div class="scroll-paper">
                <div class="ink-text">
                    <div class="ink-line"></div>
                    <div class="ink-line line-2"></div>
                    <div class="ink-line line-3"></div>
                </div>
            </div>
            <div class="scroll-roll bottom-roll"></div>
            
            <svg class="quill-gold" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#d4af37;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#fcf6ba;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#aa771c;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M80,10 C60,20 40,50 30,90 C50,70 70,40 80,10" fill="url(#goldGrad)" />
                <path d="M30,90 L35,85" stroke="#131314" stroke-width="2" />
                <path d="M45,60 Q55,55 65,50" fill="none" stroke="rgba(0,0,0,0.2)" stroke-width="1" />
            </svg>
            
            <div class="splash-text">My Place</div>
        </div>
    </div>

    <div id="login-screen" class="screen">
        <h1 style="color: var(--brand-blue); font-size: 42px; margin-bottom: 30px;">My Place</h1>
        <button class="google-btn" id="btn-login">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
    </div>

    <div id="list-screen" class="screen">
        <div class="header"><b>My Place</b></div>
        <div id="chat-list" class="chat-list"></div>
        <div class="fab" id="btn-add">+</div>
    </div>

    <div id="chat-screen" class="screen">
        <div class="header">
            <div id="chat-back" style="cursor:pointer; font-size:24px; margin-right:15px;">‚Üê</div>
            <div id="chat-avatar" class="avatar" style="width:35px; height:35px; margin:0; margin-right:10px;"></div>
            <div id="chat-name" style="font-weight:500;"></div>
        </div>
        <div id="notes-area" class="notes-area"></div>
        <div class="input-bar">
            <textarea id="note-input" rows="1" placeholder="–ù–æ—Ç–∞—Ç–∫–∞..."></textarea>
            <button id="btn-send" style="color:var(--acc); background:none; border:none; font-weight:bold;">–û–ö</button>
        </div>
    </div>

    <div id="edit-screen" class="screen">
        <div class="header">
            <div id="edit-back" style="cursor:pointer; font-size:24px; margin-right:15px;">‚Üê</div>
            <div style="flex:1;">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</div>
            <div id="btn-save" style="color:var(--acc); font-weight:bold; cursor:pointer;">–ì–û–¢–û–í–û</div>
        </div>
        <div style="overflow-y: auto; flex: 1;">
            <div class="profile-top">
                <div id="edit-img" class="avatar" style="width:100px; height:100px; margin:0; cursor:pointer;" onclick="document.getElementById('file-in').click()">?</div>
                <input type="file" id="file-in" style="display:none" accept="image/*">
                <div class="edit-inputs">
                    <label>–ü–†–Ü–ó–í–ò–©–ï</label><input type="text" id="in-ln">
                    <label>–Ü–ú'–Ø</label><input type="text" id="in-fn">
                    <label>–ù–û–ú–ï–† –¢–ï–õ–ï–§–û–ù–£</label><input type="tel" id="in-tel">
                    <label>–î–ê–¢–ê –ù–ê–†–û–î–ñ–ï–ù–ù–Ø</label><input type="date" id="in-dob">
                </div>
            </div>
            <div class="card-box">
                <div class="row"><span>–ö–ª—ñ—î–Ω—Ç</span><label class="switch"><input type="checkbox" id="chk-c"><span class="slider"></span></label></div>
                <div class="row"><span>–ü–∞—Ä—Ç–Ω–µ—Ä</span><label class="switch"><input type="checkbox" id="chk-p"><span class="slider"></span></label></div>
            </div>
        </div>
    </div>

    <div class="nav-bar" id="bottom-nav" style="display:none;">
        <div class="nav-item active-nav" id="f-all">üë§ –í—Å—ñ</div>
        <div class="nav-item" id="f-client">üõí –ö–ª—ñ—î–Ω—Ç–∏</div>
        <div class="nav-item" id="f-partner">ü§ù –ö–æ–º–∞–Ω–¥–∞</div>
        <div class="nav-item" id="f-profile">üÜî –ü—Ä–æ—Ñ—ñ–ª—å</div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const cfg = {
        apiKey: "AIzaSyBLi2NoAigr1CDQm98iZHUZXNeDzJMwwxY",
        authDomain: "starlife-crm.firebaseapp.com",
        projectId: "starlife-crm",
        storageBucket: "starlife-crm.firebasestorage.app",
        messagingSenderId: "1022280682130",
        appId: "1:1022280682130:web:3ea517e8b6d22c7787744b"
    };

    const app = initializeApp(cfg);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const prov = new GoogleAuthProvider();

    let clients = [], curId = null, filter = 'all', tempImg = "";

    const switchScreen = id => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('bottom-nav').style.display = (id==='list-screen') ? 'flex' : 'none';
    };

    const hideSplash = () => { document.getElementById('splash-screen').style.display = 'none'; };
    setTimeout(hideSplash, 4000);

    onAuthStateChanged(auth, u => {
        if(u) {
            onSnapshot(doc(db, "users", u.uid), d => {
                clients = d.exists() ? d.data().clients || [] : [];
                window.render(); hideSplash();
                if(!document.querySelector('.screen.active')) switchScreen('list-screen');
            });
        } else { hideSplash(); switchScreen('login-screen'); }
    });

    document.getElementById('btn-login').onclick = () => signInWithPopup(auth, prov);
    document.getElementById('btn-add').onclick = () => { curId=null; switchScreen('edit-screen'); };
    
    document.getElementById('btn-save').onclick = async () => {
        const d = { 
            ln: document.getElementById('in-ln').value, fn: document.getElementById('in-fn').value, 
            tel: document.getElementById('in-tel').value, dob: document.getElementById('in-dob').value, 
            isPartner: document.getElementById('chk-p').checked, isClient: document.getElementById('chk-c').checked,
            img: tempImg
        };
        if(!curId) { curId=Date.now(); clients.push({id:curId, ...d, notes:[]}); }
        else { const i=clients.findIndex(x=>x.id==curId); clients[i]={...clients[i],...d}; }
        await setDoc(doc(db, "users", auth.currentUser.uid), { clients });
        switchScreen('list-screen');
    };

    window.render = () => {
        const b = document.getElementById('chat-list');
        b.innerHTML = clients.map(c => `
            <div class="chat-item" onclick="window.openChat(${c.id})">
                <div class="avatar" style="${c.img?`background-image:url(${c.img})`:''}"></div>
                <b>${c.ln||''} ${c.fn||''}</b>
            </div>
        `).join('');
    };

    window.openChat = id => { curId=id; window.updateChat(); switchScreen('chat-screen'); };
    window.updateChat = () => {
        const c = clients.find(x=>x.id==curId);
        document.getElementById('chat-name').innerText = `${c.ln||''} ${c.fn||''}`;
        document.getElementById('notes-area').innerHTML = (c.notes||[]).map(n=>`<div class="note-bubble">${n.text}</div>`).join('');
    };

    document.getElementById('file-in').onchange = e => {
        const r=new FileReader(); r.onload=ev=>{tempImg=ev.target.result; document.getElementById('edit-img').style.backgroundImage=`url(${tempImg})`;};
        r.readAsDataURL(e.target.files[0]);
    };
    
    document.getElementById('chat-back').onclick = () => switchScreen('list-screen');
    document.getElementById('edit-back').onclick = () => switchScreen('list-screen');
</script>
</body>
</html>
